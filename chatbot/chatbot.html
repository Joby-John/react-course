<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ChatBot</title>
    <style>
        body{
            font-family: Arial, Helvetica, sans-serif;
            margin:0px 8px;
        }
        .send-button{
            color: white;
            background-color: rgb(25, 135, 84);
            padding: 12px 20px;
            margin-left: 10px;
            border: none;
            border-radius: 10px;
            font-size: 15px;
            cursor: pointer;
        }
        .chat-input{
            padding: 12px 15px;
            border-radius: 10px;
            border-width: 1px;
            font-size: 15px;
            flex-grow: 1;
        }
        .chat-input-container{
            display: flex;
            margin-bottom: 60px;
        }

        .app-container{
            max-width: 600px;
            margin-left: auto;
            margin-right: auto;
            height: 100vh;
            display: flex;
            flex-direction:column;
        }
        .chat-message-user{
            display: flex;
            justify-content: end;
            align-items: start;
        }

        .chat-message-robot{
            display: flex;
            justify-content: start;
            align-items: start;
        }

        .chat-mssg-txt{
            background-color: rgb(238, 238, 238);
            padding: 15px 20px;
            margin: 10px 20px;
            border-radius: 10px;
            max-width: 300px;
        }

        .chat-mssg-profile{
            width: 45px;
        }

        .chat-messages-container{
            flex-grow: 1;
            margin-top: 20px;
            overflow: scroll;
            scrollbar-width: none;
            
        }
    </style>
</head>
<body>

    <div class="js-container">
    </div>
    
    <!-- for react.js -->
    <script src="https://unpkg.com/supersimpledev/react.js"></script>
    <!-- for react-dom -->
    <script src="https://unpkg.com/supersimpledev/react-dom.js"></script>
    <script src="https://unpkg.com/supersimpledev/chatbot.js"></script>
    <!-- for babel -->
    <script src="https://unpkg.com/supersimpledev/babel.js"></script>

    <script type="text/babel">

        function wait(ms){
            return new Promise(resolve=>{
                setTimeout(resolve, ms);
            })
        }
        function ChatInput({chatMessages, setChatMessages}){

            const [inputText, setInputText] = React.useState('');

            function saveInputText(event){
                setInputText(event.target.value);
            }

            async function sendMessage(){
                const userMessage = inputText;
                setChatMessages(prev=>[
                    ...prev,
                    {
                        message:userMessage,
                        sender:'user',
                        id:crypto.randomUUID()
                    },
                    {
                        message:'Typing...',
                        sender:'robot',
                        id:'typing'
                    }
                ]);
                setInputText('');

                await wait(1500);

                const respose = Chatbot.getResponse(userMessage);
                
                
                setChatMessages(prev=>
                    prev.map(mssg=>
                    mssg.id === 'typing'
                    ?{...mssg, 
                        message:respose,
                        id:'crypto.randomUUID'}
                    : mssg
                    )
                );

               

                    
                    
            }

            function validateKey(event){
                if(event.key === 'Enter'){
                    sendMessage();
                }else if(event.key === 'Escape' || event.key === 'Esc'){
                    setInputText('');
                }
            }

            return ( 
                <div className="chat-input-container">
                    <input 
                        type="text" 
                        placeholder="Send a message to Chatbot" 
                        size="30"
                        onChange={saveInputText}
                        onKeyDown={validateKey}
                        value={inputText}
                        className="chat-input"
                        
                    /> 
                    <button
                        onClick={sendMessage}
                        className="send-button" 
                    >Send</button>
                </div>
            );
        }

        function ChatMessage({message, sender}){
            //const message = props.message;
            //const sender = props.sender;
            //const {message, sender} = props;

            /*
            if(sender === 'robot'){  
                return(
                     <div>
                        <img src="./images/robot.png" alt="profile picture" width="50"/>
                        {message}
                        
                    </div>
                );
                
            }
           */

            return (
                <div className={`chat-message-${sender}`}>
                    {
                        sender === 'robot' && (
                            <img src="./images/robot.png" 
                                 alt="profile picture" 
                                 className="chat-mssg-profile"/>
                            )  
                    }
                    <div className="chat-mssg-txt">
                        {message}
                    </div>
                    

                    {
                    sender === 'user' && (
                            <img src="./images/user.png" 
                                 alt="profile picture" 
                                 className="chat-mssg-profile"/>
                                )
                    }
                </div>
            );
        }

        function ChatMessages({chatMessages}){
            const chatMessagesRef =  React.useRef(null);
            
            React.useEffect(()=>{
               const containerElem = chatMessagesRef.current;
               if(containerElem){
                containerElem.scrollTop = containerElem.scrollHeight;
               }
            }, [chatMessages]);

            return (
                <div className="chat-messages-container"
                ref={chatMessagesRef}>
                    {
                        chatMessages.map((chatMessage)=>{
                            return (
                                <ChatMessage
                                    key={chatMessage.id}
                                    message={chatMessage.message}
                                    sender={chatMessage.sender}
                                />
                            )
                        })
                    }
                </div>
            );


        }

        function App(){
            //syntax of useState
            //const [currentValue, setCurrentValue] = React.useState(initialValue);

             const [chatMessages, setChatMessages] = React.useState([
                {
                    id:crypto.randomUUID(),
                    message: "Hello, How can I Help you today",
                    sender: "robot"
                },
            ]);

            //const [chatMessages, setChatMessages] = array;
            //const chatMessages = array[0];
            //const setChatMessages = array[1];

            return (
                <div className="app-container">
                    
                    <ChatMessages
                        chatMessages={chatMessages}
                    />

                    <ChatInput 
                        chatMessages={chatMessages}
                        setChatMessages={setChatMessages}
                    />
                
                </div>
            );
        }

        const container = document.querySelector('.js-container');
        ReactDOM.createRoot(container).render(<App/>);
    </script>
</body>
</html>



